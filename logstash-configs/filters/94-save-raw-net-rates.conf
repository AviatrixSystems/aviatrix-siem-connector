# Save Raw Network Rate/Cumulative Strings (Dynatrace only)
# Preserves original string values (e.g. "54.07Kb", "2.49GB") in [@metadata]
# before filter 95 truncates them via integer conversion.
#
# The Dynatrace MINT builder needs these raw strings to compute accurate
# byte values (e.g. "54.07Kb" -> 55367.68 bytes/s).
#
# Only runs when DT_METRICS_URL is set (dynatrace-metrics output).

filter {
    if "gw_net_stats" in [tags] and "${DT_METRICS_URL:}" != "" {
        mutate {
            id => "save-raw-net-rates"
            copy => {
                "total_rx_rate" => "[@metadata][raw_total_rx_rate]"
                "total_tx_rate" => "[@metadata][raw_total_tx_rate]"
                "total_rx_tx_rate" => "[@metadata][raw_total_rx_tx_rate]"
                "total_rx_cum" => "[@metadata][raw_total_rx_cum]"
                "total_tx_cum" => "[@metadata][raw_total_tx_cum]"
                "total_rx_tx_cum" => "[@metadata][raw_total_rx_tx_cum]"
            }
        }
    }
}
