# Aviatrix Custom Grok Patterns
# Used by all Logstash filter modules for parsing Aviatrix syslog messages

# Basic patterns (existing)
NUMSTAT (?:%{BASE10NUM}\w.)
AVXDATE %{YEAR}-%{MONTHNUM}-%{MONTHDAY}.*%{TIME}
RULE .*\w
SYSLOG_TIMESTAMP (%{TIMESTAMP_ISO8601}|(%{MONTH} +%{MONTHDAY} +%{TIME}))
CONTROLLER_NAME Controller-
TUNNEL_GW %{NOTSPACE}(%{NOTSPACE} %{NOTSPACE})

# Enhanced patterns for 8.2+ support
AVX_GATEWAY_HOST GW-%{HOSTNAME:gw_hostname}-%{IP:gw_ip}
AVX_MICROSEG_HEADER microseg:|AviatrixGwMicrosegPacket:
AVX_L7_HEADER ats_dcf:|traffic_server(\[%{NUMBER}\]:)?

# 8.2 Session fields pattern (for L4 microseg end-of-session logs)
AVX_SESSION_FIELDS (SESSION_EVENT=%{NUMBER:session_event} SESSION_END_REASON=%{NUMBER:session_end_reason} SESSION_PACKET_COUNT=%{NUMBER:session_packet_count} SESSION_BYTE_COUNT=%{NUMBER:session_byte_count} SESSION_DURATION=%{NUMBER:session_duration_ns})?

# Syslog priority pattern
SYSLOG_PRI <%{NUMBER:syslog_pri}>

# Gateway identifier with optional IP suffix
GW_IDENTIFIER GW-%{HOSTNAME}-%{IP}
